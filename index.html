<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<style>
    body {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: row;
    }

    #soundsSector {
        display: flex;
        flex-direction: column;
    }

    #recordSector{
        display: flex;
        flex-direction: column;
    }

    .row {
        display: flex;
        flex-direction: row;
    }

    .sound {
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 12.5px;
        margin-right: 10px;
        margin-bottom: 10px;
        width: 100px;
        height: 100px;
        background: orange;
        box-shadow: 2px 2px 5px black;
    }

    .path{
        display: flex;
        flex-direction: column;
    }

    .choosePath{
        display: flex;
        flex-direction: row;
    }

    button{
        width: 100px;
        height: 30px;
        border-radius: 10px;
        background: gray;
        font-size: 20px;
    }
    button:hover{
        background: darkgray;
    }
    .choosePath span{
        font-size: 20px;
    }
    input{
        width: 20px;
        height: 20px;
    }
</style>

<body>
    <audio src=""></audio>
    <div id="soundsSector">
        <div class="row">
            <div class="sound" id="Q">
                <span>snap-yes_1</span>
            </div>
            <div class="sound" id="W">
                <span>pickle_rick</span>
            </div>
            <div class="sound" id="E">
                <span>my-man</span>
            </div>
            <div class="sound" id="R">
                <span>hihat</span>
            </div>
        </div>
        <div class="row">
            <div class="sound" id="A">
                <span>openhat</span>
            </div>
            <div class="sound" id="S">
                <span>ride</span>
            </div>
            <div class="sound" id="D">
                <span>tink</span>
            </div>
            <div class="sound" id="F">
                <span>clap</span>
            </div>
        </div>
        <div class="row">
            <div class="sound" id="Z">
                <span>boom</span>
            </div>
            <div class="sound" id="X">
                <span>snare</span>
            </div>
            <div class="sound" id="C">
                <span>kick</span>
            </div>
            <div class="sound" id="V">
                <span>tom</span>
            </div>
        </div>
    </div>
    <div id="recordSector">
        <div class="path">
            <div class="choosePath">
                    <span>Rec 1</span>
                    <input type="checkbox" id="rec1">
            </div>
            <div class="choosePath">
                <span>Rec 2</span>
                    <input type="checkbox" id="rec2">
            </div>
            <div class="choosePath">
                <span>Rec 3</span>
                <input type="checkbox" id="rec3">
            </div>
            <div class="choosePath">
                <span>Rec 4</span>
                <input type="checkbox" id="rec4">
            </div>
            <button id="playBtn">Play</button>
        </div>
    </div>
</body>
<script>
    const snd = document.querySelector('audio');

    //odtworzenie dźwięku po wciśnięciu danego przycisku
    document.addEventListener('keypress', (e) => {
        //wyzerowanie licznika czasu w znaczniku audio dla odtwarzanego dźwięku
        snd.currentTime = 0;
        switch (e.charCode) {
            case 113:
                //pobranie ścieżki do dźwięku
                snd.src = 'samples/snap-yes_1.mp3';
                //wywołanie funckji play odtważającej dźwięk
                snd.play();
                //wywołanie funkcji, która animuje wciśnięcie przycisku na ekranie
                press('Q');
                break;
            case 119:
                snd.src = 'samples/pickle_rick.mp3';
                snd.play();
                press('W');
                break;
            case 101:
                snd.src = 'samples/my-man.mp3';
                snd.play();
                press('E');
                break;
            case 114:
                snd.src = 'samples/hihat.wav';
                snd.play();
                press('R');
                break;
            case 97:
                snd.src = 'samples/openhat.wav';
                snd.play();
                press('A');
                break;
            case 115:
                snd.src = 'samples/ride.wav';
                snd.play();
                press('S');
                break;
            case 100:
                snd.src = 'samples/tink.wav';
                snd.play();
                press('D');
                break;
            case 102:
                snd.src = 'samples/clap.wav';
                snd.play();
                press('F');
                break;
            case 122:
                snd.src = 'samples/boom.wav';
                snd.play();
                press('Z');
                break;
            case 120:
                snd.src = 'samples/snare.wav';
                snd.play();
                press('X');
                break;
            case 99:
                snd.src = 'samples/kick.wav';
                snd.play();
                press('C');
                break;
            case 118:
                snd.src = 'samples/tom.wav';
                snd.play();
                press('V');
                break;
        }

    })

    //funkcja animująca wciśnięcie przycisku
    function press(id) {
        document.getElementById(id).style.background = 'blue';
        document.getElementById(id).style.boxShadow = 'none';
    }

    //event wywołujący funkcję animującą puszczenie przycisku
    document.addEventListener('keyup', (e) => {
        switch (e.keyCode) {
            case 81:
                //wywołanie funkcji puszczenia przycisku
                up('Q');
                break;
            case 87:
                up('W');
                break;
            case 69:
                up('E');
                break;
            case 82:
                up('R');
                break;
            case 65:
                up('A');
                break;
            case 83:
                up('S');
                break;
            case 68:
                up('D');
                break;
            case 70:
                up('F');
                break;
            case 90:
                up('Z');
                break;
            case 88:
                up('X');
                break;
            case 67:
                up('C');
                break;
            case 86:
                up('V');
                break;
        }
    })

    //funkcja animująca puszczenie przycisku
    function up(id) {
        document.getElementById(id).style.background = 'orange';
        document.getElementById(id).style.boxShadow = '2px 2px 5px black';
    }

    const lineOne = document.getElementById('rec1');
    const lineTwo = document.getElementById('rec2');
    const lineThree = document.getElementById('rec3');
    const lineFour = document.getElementById('rec4');
    const playBtn = document.getElementById('playBtn');
    
    //tablica zagranych dźwięków
    let recKey = [];
    //tablica przechowywująca czas do zagrania kolejnego dźwięku
    let recTime = [];

    //funkcja rejestrująca zagraną melodię wykorzystuje recKey, recTime oraz sprawdza czy checkbox jest zaznaczony
    function rec(checkbox, recKey, recTime) {
        if (checkbox.checked) {
            let i = 0;
            document.onkeydown = function (e) {
                //po wciśnięciu przycisku zapisanie czasu kiedy to został zagrany dźwięk i dodanie czasu do tablicy recTime oraz przycisku do tablicy recKey z tym samym indexem(i)
                let time = new Date().getTime();
                let key = e.keyCode;
                recKey[i] = key;
                recTime[i] = time;
                i++;
            }
        }
    }

    //funkcja stworzona na potrzebę odtworzenia zarejestrowanych dźwięków
    function keyPlays(keyCode) {
        switch (keyCode) {
            case 81:
                snd.src = 'samples/snap-yes_1.mp3';
                return 81;
                break;
            case 87:
                snd.src = 'samples/pickle_rick.mp3';
                break;
            case 69:
                snd.src = 'samples/my-man.mp3';
                break;
            case 82:
                snd.src = 'samples/hihat.wav';
                break;
            case 65:
                snd.src = 'samples/openhat.wav';
                break;
            case 83:
                snd.src = 'samples/ride.wav';
                break;
            case 68:
                snd.src = 'samples/tink.wav';
                break;
            case 70:
                snd.src = 'samples/clap.wav';
                break;
            case 90:
                snd.src = 'samples/boom.wav';
                break;
            case 88:
                snd.src = 'samples/snare.wav';
                break;
            case 67:
                snd.src = 'samples/kick.wav';
                break;
            case 86:
                snd.src = 'samples/tom.wav';
                break;
        }
        snd.play();
    }

    //funkcja odtwarzająca zarejestrowaną sekwencję dźwięków
    function playLine(recKey, recTime) {
        for (let i = 0; i < recKey.length; i++) {
            if (i !== 0) {
                setTimeout(function () { keyPlays(recKey[i]) }, timeToNextSound(i, recTime));
            }
            else {
                keyPlays(recKey[i]);
            }
        }
    }
    //funkcja obliczająca czas do następnego dźwięku
    function timeToNextSound(i, recTime) {
        return recTime[i] - recTime[0];
    }

    //eventy wywołujące funkcję rec do nagrania sekwencji dźwięków
    lineOne.addEventListener('change', function () {
        rec(lineOne, recKey, recTime);
    });

    lineTwo.addEventListener('change', function () {
        rec(lineTwo, recKey, recTime);
    });

    lineThree.addEventListener('change', function () {
        rec(lineTwo, recKey, recTime);
    });

    lineFour.addEventListener('change', function () {
        rec(lineTwo, recKey, recTime);
    });

    //event wywołujący odtworzenie nagranych dźwięków
    playBtn.addEventListener('click', (e) => {
        playLine(recKey, recTime);
    });
</script>

</html>